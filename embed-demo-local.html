<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3speak Player Embedding Demo (LOCAL)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 40px;
        }

        .demo-section {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .demo-section h2 {
            margin-bottom: 20px;
            color: #4a9eff;
        }

        .demo-section p {
            color: #ccc;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .video-wrapper-16-9 {
            aspect-ratio: 16 / 9;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .video-wrapper-16-9 iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-wrapper-3-4 {
            aspect-ratio: 3 / 4;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .video-wrapper-3-4 iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-wrapper-1-1 {
            aspect-ratio: 1 / 1;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .video-wrapper-1-1 iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .code-block {
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            overflow-x: auto;
        }

        .code-block code {
            color: #4af;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            white-space: pre;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .comparison-item h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }
        }

        .local-badge {
            background: #ff6b6b;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>3speak Player Demo <span class="local-badge">LOCAL</span></h1>
        <p class="subtitle">Testing local development build - all iframes point to localhost</p>

        <!-- Desktop Layout Tests -->
        <div class="demo-section">
            <h2>1. Desktop Layout - YouTube-Style 16:9</h2>
            <p>The <code>&layout=desktop</code> mode maintains a strict 16:9 aspect ratio. Vertical videos get pillarboxing (black bars on sides).</p>

            <div class="comparison">
                <div class="comparison-item">
                    <h3>Vertical Video (with pillarboxing)</h3>
                    <div class="video-wrapper-16-9">
                        <iframe
                            src="/watch?v=vaipraonde/560bdc59&mode=iframe&layout=desktop&debug=1"
                            frameborder="0"
                            allow="autoplay; fullscreen"
                            allowfullscreen>
                        </iframe>
                    </div>
                    <div class="code-block">
                        <code>&layout=desktop
/* Vertical videos get black bars on sides */</code>
                    </div>
                </div>

                <div class="comparison-item">
                    <h3>Horizontal Video (fills container)</h3>
                    <div class="video-wrapper-16-9">
                        <iframe
                            src="/watch?v=meno/1czchhmr&mode=iframe&layout=desktop&debug=1"
                            frameborder="0"
                            allow="autoplay; fullscreen"
                            allowfullscreen>
                        </iframe>
                    </div>
                    <div class="code-block">
                        <code>&layout=desktop
/* Horizontal videos fill naturally */</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Layout Tests -->
        <div class="demo-section">
            <h2>2. Mobile Layout - Tall Container (3:4)</h2>
            <p>The <code>&layout=mobile</code> parameter creates a tall 3:4 container. Works for both vertical AND horizontal videos.</p>

            <div class="comparison">
                <div class="comparison-item">
                    <h3>Vertical Video</h3>
                    <div class="video-wrapper-3-4" style="max-width: 350px; margin: 0 auto;">
                        <iframe
                            src="/watch?v=vaipraonde/560bdc59&mode=iframe&layout=mobile&debug=1"
                            frameborder="0"
                            allow="autoplay; fullscreen"
                            allowfullscreen>
                        </iframe>
                    </div>
                    <div class="code-block">
                        <code>&layout=mobile</code>
                    </div>
                </div>

                <div class="comparison-item">
                    <h3>Horizontal Video</h3>
                    <div class="video-wrapper-3-4" style="max-width: 350px; margin: 0 auto;">
                        <iframe
                            src="/watch?v=meno/1czchhmr&mode=iframe&layout=mobile&debug=1"
                            frameborder="0"
                            allow="autoplay; fullscreen"
                            allowfullscreen>
                        </iframe>
                    </div>
                    <div class="code-block">
                        <code>&layout=mobile
/* Horizontal gets letterboxing */</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Square Layout Test -->
        <div class="demo-section">
            <h2>3. Square Layout - 1:1 Container</h2>
            <p>The <code>&layout=square</code> creates a 1:1 square container.</p>

            <div class="video-wrapper-1-1" style="max-width: 400px; margin: 20px auto;">
                <iframe
                    src="/watch?v=vaipraonde/560bdc59&mode=iframe&layout=square&debug=1"
                    frameborder="0"
                    allow="autoplay; fullscreen"
                    allowfullscreen>
                </iframe>
            </div>
            <div class="code-block">
                <code>&layout=square</code>
            </div>
        </div>

        <!-- Autoplay Test -->
        <div class="demo-section">
            <h2>4. Autoplay Test</h2>
            <p>Test autoplay with the <code>&autoplay=1</code> parameter.</p>

            <div class="video-wrapper-16-9" style="max-width: 800px; margin: 0 auto;">
                <iframe
                    src="/watch?v=meno/1czchhmr&mode=iframe&layout=desktop&autoplay=1&debug=1"
                    frameborder="0"
                    allow="autoplay; fullscreen"
                    allowfullscreen>
                </iframe>
            </div>
            <div class="code-block">
                <code>&autoplay=1&layout=desktop</code>
            </div>
        </div>

        <!-- External Controls Test -->
        <div class="demo-section">
            <h2>5. External Controls via postMessage API</h2>
            <p>This demo shows how to control the player from outside the iframe using the postMessage API. The player has <code>&controls=0</code> to hide the built-in controls.</p>

            <div style="display: flex; gap: 30px; align-items: flex-start; flex-wrap: wrap;">
                <div class="video-wrapper-3-4" style="max-width: 300px; flex-shrink: 0;">
                    <iframe
                        id="controlled-player"
                        src="/watch?v=vaipraonde/560bdc59&mode=iframe&layout=mobile&controls=0&debug=1"
                        frameborder="0"
                        allow="autoplay; fullscreen"
                        allowfullscreen>
                    </iframe>
                </div>

                <div style="flex: 1; min-width: 250px;">
                    <h3 style="margin-bottom: 15px;">External Controls</h3>

                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button onclick="sendCommand('seekBackward')" style="padding: 12px 16px; font-size: 16px; cursor: pointer; background: #666; color: white; border: none; border-radius: 6px;" title="Back 10s">
                            ‚è™ 10s
                        </button>
                        <button id="play-pause-btn" onclick="togglePlayPause()" style="padding: 12px 24px; font-size: 16px; cursor: pointer; background: #4a9eff; color: white; border: none; border-radius: 6px; min-width: 100px;">
                            ‚ñ∂ Play
                        </button>
                        <button onclick="sendCommand('seekForward')" style="padding: 12px 16px; font-size: 16px; cursor: pointer; background: #666; color: white; border: none; border-radius: 6px;" title="Forward 10s">
                            10s ‚è©
                        </button>
                        <button onclick="sendCommand('toggleFullscreen')" style="padding: 12px 24px; font-size: 16px; cursor: pointer; background: #4a9eff; color: white; border: none; border-radius: 6px;">
                            ‚õ∂ Fullscreen
                        </button>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 12px; color: #888;">
                            <span id="time-current">0:00</span>
                            <span id="time-duration">0:00</span>
                        </div>
                        <div id="progress-bar" style="position: relative; height: 6px; background: #444; border-radius: 3px; cursor: pointer; width: 100%; max-width: 300px;">
                            <div id="progress-fill" style="position: absolute; top: 0; left: 0; height: 100%; background: #4a9eff; border-radius: 3px; width: 0%; pointer-events: none;"></div>
                            <div id="progress-handle" style="position: absolute; top: 50%; left: 0%; transform: translate(-50%, -50%); width: 14px; height: 14px; background: #fff; border-radius: 50%; box-shadow: 0 1px 4px rgba(0,0,0,0.4); cursor: grab;"></div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 15px;">
                        <label style="white-space: nowrap;">Volume: <span id="volume-display">100%</span></label>
                        <input
                            type="range"
                            id="volume-slider"
                            min="0"
                            max="100"
                            value="100"
                            oninput="setVolume(this.value)"
                            style="width: 150px; cursor: pointer;"
                        >
                        <button id="mute-btn" onclick="toggleMute()" style="padding: 6px 12px; font-size: 14px; cursor: pointer; background: #666; color: white; border: none; border-radius: 4px;">
                            üîä
                        </button>
                    </div>

                    <div class="code-block" style="margin-top: 20px;">
                        <code>// Embed with hidden controls: &controls=0
// &lt;iframe src="...?v=author/id&mode=iframe&controls=0"&gt;

// Setup: Get iframe and create helper
const iframe = document.getElementById('player');
const send = (cmd, data = {}) =>
  iframe.contentWindow.postMessage({ type: cmd, ...data }, '*');

// PLAYBACK CONTROLS
send('toggle-play');        // Toggle play/pause
send('play');               // Start playing
send('pause');              // Pause video
send('toggleFullscreen');   // Toggle fullscreen

// VOLUME CONTROLS
send('setVolume', { volume: 0.5 });  // Set to 50%
send('volumeUp', { step: 0.1 });     // +10%
send('volumeDown', { step: 0.2 });   // -20%
send('toggleMute');                   // Toggle mute
send('mute');                         // Mute
send('unmute');                       // Unmute

// SEEKING
send('seek', { time: 30 });           // Go to 30s
send('seekForward', { seconds: 15 }); // +15s
send('seekBackward', { seconds: 5 }); // -5s
send('seekForward');                  // +10s (default)
send('seekBackward');                 // -10s (default)

// GET CURRENT STATE
send('getState');  // Triggers '3speak-state' event

// LISTEN FOR EVENTS
window.addEventListener('message', (e) => {
  const { type, currentTime, duration,
          paused, muted, volume } = e.data;

  if (type === '3speak-timeupdate') {
    console.log(`${currentTime}s / ${duration}s`);
  }
  if (type === '3speak-play') console.log('Playing');
  if (type === '3speak-pause') console.log('Paused');
  if (type === '3speak-ended') console.log('Ended');
});</code>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let videoDuration = 0;
        let isSeeking = false;
        let isPlaying = false;
        let isMuted = false;

        function sendCommand(command, data = {}) {
            const iframe = document.getElementById('controlled-player');
            iframe.contentWindow.postMessage({ type: command, ...data }, '*');
        }

        function togglePlayPause() {
            sendCommand('toggle-play');
        }

        function updatePlayPauseButton() {
            const btn = document.getElementById('play-pause-btn');
            btn.innerHTML = isPlaying ? '‚è∏ Pause' : '‚ñ∂ Play';
        }

        function toggleMute() {
            sendCommand('toggleMute');
        }

        function updateMuteButton() {
            const btn = document.getElementById('mute-btn');
            btn.innerHTML = isMuted ? 'üîá' : 'üîä';
        }

        function setVolume(value) {
            const volume = value / 100;
            document.getElementById('volume-display').textContent = value + '%';
            sendCommand('setVolume', { volume: volume });
        }

        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function updateProgress(percent) {
            document.getElementById('progress-fill').style.width = percent + '%';
            document.getElementById('progress-handle').style.left = percent + '%';
        }

        // Progress bar drag handling
        const progressBar = document.getElementById('progress-bar');
        const progressHandle = document.getElementById('progress-handle');

        function seekFromEvent(e) {
            const rect = progressBar.getBoundingClientRect();
            const percent = Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100));
            updateProgress(percent);
            if (videoDuration > 0) {
                const time = (percent / 100) * videoDuration;
                sendCommand('seek', { time: time });
            }
        }

        progressBar.addEventListener('mousedown', (e) => {
            isSeeking = true;
            progressHandle.style.cursor = 'grabbing';
            seekFromEvent(e);

            const onMove = (e) => seekFromEvent(e);
            const onUp = () => {
                isSeeking = false;
                progressHandle.style.cursor = 'grab';
                document.removeEventListener('mousemove', onMove);
                document.removeEventListener('mouseup', onUp);
            };

            document.addEventListener('mousemove', onMove);
            document.addEventListener('mouseup', onUp);
        });

        // Listen for messages from the player
        window.addEventListener('message', function(event) {
            const data = event.data;
            if (!data || !data.type) return;

            switch (data.type) {
                case '3speak-timeupdate':
                    if (!isSeeking && data.duration > 0) {
                        videoDuration = data.duration;
                        const progress = (data.currentTime / data.duration) * 100;
                        updateProgress(progress);
                        document.getElementById('time-current').textContent = formatTime(data.currentTime);
                        document.getElementById('time-duration').textContent = formatTime(data.duration);
                        // Update play state from timeupdate
                        if (isPlaying !== !data.paused) {
                            isPlaying = !data.paused;
                            updatePlayPauseButton();
                        }
                        // Update mute state
                        if (isMuted !== data.muted) {
                            isMuted = data.muted;
                            updateMuteButton();
                        }
                    }
                    break;
                case '3speak-durationchange':
                    videoDuration = data.duration;
                    document.getElementById('time-duration').textContent = formatTime(data.duration);
                    break;
                case '3speak-play':
                    isPlaying = true;
                    updatePlayPauseButton();
                    break;
                case '3speak-pause':
                case '3speak-ended':
                    isPlaying = false;
                    updatePlayPauseButton();
                    break;
            }
        });
    </script>
</body>
</html>
